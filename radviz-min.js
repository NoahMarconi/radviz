var utils={merge:function(n,e){for(var t in e)e[t]&&e[t].constructor==Object&&n[t]?this.merge(n[t],e[t]):n[t]=e[t]},mergeAll:function(){for(var n={},e=arguments,t=0;t<e.length;t++)this.merge(n,e[t]);return n},htmlToNode:function(n,e){for(;e.lastChild;)e.removeChild(e.lastChild);return this.appendHtmlToNode(n,e)},appendHtmlToNode:function(n,e){return e.appendChild(document.importNode((new DOMParser).parseFromString(n,"text/html").body.childNodes[0],!0))}},radvizComponent=function(){var n={el:null,size:400,margin:50,colorScale:d3.scale.ordinal().range(["skyblue","orange","lime"]),colorAccessor:null,dimensions:[],drawLinks:!0,zoomFactor:1,dotRadius:4,useRepulsion:!1,tooltipFormatter:function(n){return n}},e=d3.dispatch("panelEnter","panelLeave","dotEnter","dotLeave"),t=d3.layout.force().chargeDistance(0).charge(-20).friction(.5),r=tooltipComponent("#tooltip"),o=function(o){o=a(o);var i="_normalized",c=n.dimensions.map(function(n){return n+i}),s=d3.scale.linear().domain([0,c.length]).range([0,2*Math.PI]),l=n.size/2-n.margin,u=o.length,d=n.dimensions.map(function(e,t){var r=s(t),o=l+Math.cos(r)*l*n.zoomFactor,i=l+Math.sin(r)*l*n.zoomFactor;return{index:u+t,x:o,y:i,fixed:!0,name:e}}),f=[];o.forEach(function(n,e){c.forEach(function(t,r){f.push({source:e,target:u+r,value:n[t]})})}),t.size([n.size,n.size]).linkStrength(function(n){return n.value}).nodes(o.concat(d)).links(f).start();var p=d3.select(n.el).append("svg").attr({width:n.size,height:n.size});p.append("rect").classed("bg",!0).attr({width:n.size,height:n.size});{var m=p.append("g").attr({transform:"translate("+[n.margin,n.margin]+")"});m.append("circle").classed("panel",!0).attr({r:l,cx:l,cy:l})}if(n.useRepulsion&&(m.on("mouseenter",function(){t.chargeDistance(60).alpha(.2),e.panelEnter()}),m.on("mouseleave",function(){t.chargeDistance(0).resume(),e.panelLeave()})),n.drawLinks)var h=m.selectAll(".link").data(f).enter().append("line").classed("link",!0);{var g=m.selectAll("circle.dot").data(o).enter().append("circle").classed("dot",!0).attr({r:n.dotRadius,fill:function(e){return n.colorScale(n.colorAccessor(e))}}).on("mouseenter",function(t){var o=d3.mouse(n.el);r.setText(n.tooltipFormatter(t)).setPosition(o[0],o[1]).show(),e.dotEnter(t)}).on("mouseout",function(n){r.hide(),e.dotLeave(n)});m.selectAll("circle.label-node").data(d).enter().append("circle").classed("label-node",!0).attr({cx:function(n){return n.x},cy:function(n){return n.y},r:4}),m.selectAll("text.label").data(d).enter().append("text").classed("label",!0).attr({x:function(n){return n.x},y:function(n){return n.y},"text-anchor":function(e){return e.x>n.size/2?"start":"end"},"dominant-baseline":function(e){return e.y>n.size/2?"hanging":"auto"},dx:function(e){return e.x>n.size/2?"4px":"-4px"},dy:function(e){return e.y>n.size/2?"4px":"-4px"}}).text(function(n){return n.name})}return t.on("tick",function(){n.drawLinks&&h.attr({x1:function(n){return n.source.x},y1:function(n){return n.source.y},x2:function(n){return n.target.x},y2:function(n){return n.target.y}}),g.attr({cx:function(n){return n.x},cy:function(n){return n.y}})}),this},i=function(e){return n=utils.mergeAll(n,e),this},a=function(e){e.forEach(function(e){n.dimensions.forEach(function(n){e[n]=+e[n]})});var t={};return n.dimensions.forEach(function(n){t[n]=d3.scale.linear().domain(d3.extent(e.map(function(e){return e[n]}))).range([0,1])}),e.forEach(function(e){n.dimensions.forEach(function(n){e[n+"_normalized"]=t[n](e[n])})}),e},c={config:i,render:o};return d3.rebind(c,e,"on"),c},tooltipComponent=function(n){var e=d3.select(n).style({position:"absolute","pointer-events":"none"}),t=function(n){return e.html(n),this},r=function(n,t){return e.style({left:n+"px",top:t+"px"}),this},o=function(){return e.style({display:"block"}),this},i=function(){return e.style({display:"none"}),this};return{setText:t,setPosition:r,show:o,hide:i}};